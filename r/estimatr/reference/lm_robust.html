<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ordinary Least Squares with Robust Standard Errors — lm_robust • estimatr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ordinary Least Squares with Robust Standard Errors — lm_robust"><meta name="description" content="This formula fits a linear model, provides a variety of
options for robust standard errors, and conducts coefficient tests"><meta property="og:description" content="This formula fits a linear model, provides a variety of
options for robust standard errors, and conducts coefficient tests"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">estimatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting started using estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/absorbing-fixed-effects.html">Absorbing Fixed Effects with estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/estimatr-in-the-tidyverse.html">estimatr in the Tidyverse</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-estimatr.html">Benchmarking estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/emmeans-examples.html">Examples with emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/mathematical-notes.html">Mathematical notes for estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/regression-tables.html">Regression Tables with estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/simulations-debiasing-dim.html">Simulations - Debiasing Difference-in-Means</a></li>
    <li><a class="dropdown-item" href="../articles/simulations-ols-variance.html">Simulations - OLS and Variance</a></li>
    <li><a class="dropdown-item" href="../articles/stata-wls-hat.html">How Stata's hat matrix differs with weights</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-software" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Software</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-software"><li><a class="external-link dropdown-item" href="http://declaredesign.org/r/declaredesign/">DeclareDesign</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/randomizr/">randomizr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/fabricatr/">fabricatr</a></li>
    <li><a class="dropdown-item" href="https://declaredesign.org/r/estimatr/">estimatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/designlibrary/">DesignLibrary</a></li>
    <li><a class="external-link dropdown-item" href="https://eos.wzb.eu/ipi/DDWizard/">DesignWizard</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://declaredesign.org">declaredesign.org</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Ordinary Least Squares with Robust Standard Errors</h1>
      <small class="dont-index">Source: <a href="https://github.com/DeclareDesign/estimatr/blob/main/R/estimatr_lm_robust.R" class="external-link"><code>R/estimatr_lm_robust.R</code></a></small>
      <div class="d-none name"><code>lm_robust.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This formula fits a linear model, provides a variety of
options for robust standard errors, and conducts coefficient tests</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lm_robust</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  <span class="va">clusters</span>,</span>
<span>  <span class="va">fixed_effects</span>,</span>
<span>  se_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ci <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  return_vcov <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  try_cholesky <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>an object of class formula, as in <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code></p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.frame</code></p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>the bare (unquoted) names of the weights variable in the
supplied data.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>An optional bare (unquoted) expression specifying a subset
of observations to be used.</p></dd>


<dt id="arg-clusters">clusters<a class="anchor" aria-label="anchor" href="#arg-clusters"></a></dt>
<dd><p>An optional bare (unquoted) name of the variable that
corresponds to the clusters in the data.</p></dd>


<dt id="arg-fixed-effects">fixed_effects<a class="anchor" aria-label="anchor" href="#arg-fixed-effects"></a></dt>
<dd><p>An optional right-sided formula containing the fixed
effects that will be projected out of the data, such as <code>~ blockID</code>. Do not
pass multiple-fixed effects with intersecting groups. Speed gains are greatest for
variables with large numbers of groups and when using "HC1" or "stata" standard errors.
See 'Details'.</p></dd>


<dt id="arg-se-type">se_type<a class="anchor" aria-label="anchor" href="#arg-se-type"></a></dt>
<dd><p>The sort of standard error sought. If <code>clusters</code> is
not specified the options are "HC0", "HC1" (or "stata", the equivalent),
 "HC2" (default), "HC3", or
"classical". If <code>clusters</code> is specified the options are "CR0", "CR2" (default), or "stata". Can also specify "none", which may speed up estimation of the coefficients.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>logical. Whether to compute and return p-values and confidence
intervals, TRUE by default.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>The significance level, 0.05 by default.</p></dd>


<dt id="arg-return-vcov">return_vcov<a class="anchor" aria-label="anchor" href="#arg-return-vcov"></a></dt>
<dd><p>logical. Whether to return the variance-covariance
matrix for later usage, TRUE by default.</p></dd>


<dt id="arg-try-cholesky">try_cholesky<a class="anchor" aria-label="anchor" href="#arg-try-cholesky"></a></dt>
<dd><p>logical. Whether to try using a Cholesky
decomposition to solve least squares instead of a QR decomposition,
FALSE by default. Using a Cholesky decomposition may result in speed gains, but should only
be used if users are sure their model is full-rank (i.e., there is no
perfect multi-collinearity)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>"lm_robust"</code>.</p>
<p>The post-estimation commands functions <code>summary</code> and <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></code>
return results in a <code>data.frame</code>. To get useful data out of the return,
you can use these data frames, you can use the resulting list directly, or
you can use the generic accessor functions <code>coef</code>, <code>vcov</code>,
<code>confint</code>, and <code>predict</code>. Marginal effects and uncertainty about
them can be gotten by passing this object to
<code><a href="https://rdrr.io/pkg/margins/man/margins.html" class="external-link">margins</a></code> from the <span class="pkg">margins</span>,
or to <code>emmeans</code> in the <span class="pkg">emmeans</span> package.</p>
<p>Users who want to print the results in TeX of HTML can use the
<code><a href="https://rdrr.io/pkg/texreg/man/extract.html" class="external-link">extract</a></code> function and the <span class="pkg">texreg</span> package.</p>
<p>If users specify a multivariate linear regression model (multiple outcomes),
then some of the below components will be of higher dimension to accommodate
the additional models.</p>
<p>An object of class <code>"lm_robust"</code> is a list containing at least the
following components:</p>
<dl><dt>coefficients</dt>
<dd><p>the estimated coefficients</p></dd>

  <dt>std.error</dt>
<dd><p>the estimated standard errors</p></dd>

  <dt>statistic</dt>
<dd><p>the t-statistic</p></dd>

  <dt>df</dt>
<dd><p>the estimated degrees of freedom</p></dd>

  <dt>p.value</dt>
<dd><p>the p-values from a two-sided t-test using <code>coefficients</code>, <code>std.error</code>, and <code>df</code></p></dd>

  <dt>conf.low</dt>
<dd><p>the lower bound of the <code>1 - alpha</code> percent confidence interval</p></dd>

  <dt>conf.high</dt>
<dd><p>the upper bound of the <code>1 - alpha</code> percent confidence interval</p></dd>

  <dt>term</dt>
<dd><p>a character vector of coefficient names</p></dd>

  <dt>alpha</dt>
<dd><p>the significance level specified by the user</p></dd>

  <dt>se_type</dt>
<dd><p>the standard error type specified by the user</p></dd>

  <dt>res_var</dt>
<dd><p>the residual variance</p></dd>

  <dt>N</dt>
<dd><p>the number of observations used</p></dd>

  <dt>k</dt>
<dd><p>the number of columns in the design matrix (includes linearly dependent columns!)</p></dd>

  <dt>rank</dt>
<dd><p>the rank of the fitted model</p></dd>

  <dt>vcov</dt>
<dd><p>the fitted variance covariance matrix</p></dd>

  <dt>r.squared</dt>
<dd><p>The \(R^2\),
  $$R^2 = 1 - Sum(e[i]^2) / Sum((y[i] - y^*)^2),$$ where \(y^*\)
  is the mean of \(y[i]\) if there is an intercept and zero otherwise,
  and \(e[i]\) is the ith residual.</p></dd>

  <dt>adj.r.squared</dt>
<dd><p>The \(R^2\) but penalized for having more parameters, <code>rank</code></p></dd>

  <dt>fstatistic</dt>
<dd><p>a vector with the value of the F-statistic with the numerator and denominator degrees of freedom</p></dd>

  <dt>weighted</dt>
<dd><p>whether or not weights were applied</p></dd>

  <dt>call</dt>
<dd><p>the original function call</p></dd>

  <dt>fitted.values</dt>
<dd><p>the matrix of predicted means</p></dd>

</dl><p>We also return <code>terms</code> and <code>contrasts</code>, used by <code>predict</code>. If <code>fixed_effects</code> are specified, then we return <code>proj_fstatistic</code>, <code>proj_r.squared</code>, and <code>proj_adj.r.squared</code>, which are model fit statistics that are computed on the projected model (after demeaning the fixed effects).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function performs linear regression and provides a variety of standard
errors. It takes a formula and data much in the same was as <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>
does, and all auxiliary variables, such as clusters and weights, can be
passed either as quoted names of columns, as bare column names, or
as a self-contained vector. Examples of usage can be seen below and in the
<a href="https://declaredesign.org/r/estimatr/articles/getting-started.html">Getting Started vignette</a>.</p>
<p>The mathematical notes in
<a href="https://declaredesign.org/r/estimatr/articles/mathematical-notes.html">this vignette</a>
specify the exact estimators used by this function.
The default variance estimators have been chosen largely in accordance with the
procedures in
<a href="https://github.com/acoppock/Green-Lab-SOP/blob/master/Green_Lab_SOP.pdf" class="external-link">this manual</a>.
The default for the case
without clusters is the HC2 estimator and the default with clusters is the
analogous CR2 estimator. Users can easily replicate Stata standard errors in
the clustered or non-clustered case by setting <code>`se_type` = "stata"</code>.</p>
<p>The function estimates the coefficients and standard errors in C++, using
the <code>RcppEigen</code> package. By default, we estimate the coefficients
using Column-Pivoting QR decomposition from the Eigen C++ library, although
users could get faster solutions by setting <code>`try_cholesky` = TRUE</code> to
use a Cholesky decomposition instead. This will likely result in quicker
solutions, but the algorithm does not reliably detect when there are linear
dependencies in the model and may fail silently if they exist.</p>
<p>If <code>`fixed_effects`</code> are specified, both the outcome and design matrix
are centered using the method of alternating projections (Halperin 1962; Gaure 2013). Specifying
fixed effects in this way will result in large speed gains with standard error
estimators that do not need to invert the matrix of fixed effects. This means using
"classical", "HC0", "HC1", "CR0", or "stata" standard errors will be faster than other
standard error estimators. Be wary when specifying fixed effects that may result
in perfect fits for some observations or if there are intersecting groups across
multiple fixed effect variables (e.g. if you specify both "year" and "country" fixed effects
with an unbalanced panel where one year you only have data for one country).</p>
<p>As with <code>`lm()`</code>, multivariate regression (multiple outcomes) will only admit
observations into the estimation that have no missingness on any outcome.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Abadie, Alberto, Susan Athey, Guido W Imbens, and Jeffrey Wooldridge. 2017. "A Class of Unbiased Estimators of the Average Treatment Effect in Randomized Experiments." arXiv Pre-Print. <a href="https://arxiv.org/abs/1710.02926v2" class="external-link">https://arxiv.org/abs/1710.02926v2</a>.</p>
<p>Bell, Robert M, and Daniel F McCaffrey. 2002. "Bias Reduction in Standard Errors for Linear Regression with Multi-Stage Samples." Survey Methodology 28 (2): 169-82.</p>
<p>Gaure, Simon. 2013. "OLS with multiple high dimensional category variables." Computational Statistics &amp; Data Analysis 66: 8-1. <a href="https://doi.org/10.1016/j.csda.2013.03.024" class="external-link">doi:10.1016/j.csda.2013.03.024</a></p>
<p>Halperin, I. 1962. "The product of projection operators." Acta Scientiarum Mathematicarum (Szeged) 23(1-2): 96-99.</p>
<p>MacKinnon, James, and Halbert White. 1985. "Some Heteroskedasticity-Consistent Covariance Matrix Estimators with Improved Finite Sample Properties." Journal of Econometrics 29 (3): 305-25. <a href="https://doi.org/10.1016/0304-4076%2885%2990158-7" class="external-link">doi:10.1016/0304-4076(85)90158-7</a>
.</p>
<p>Pustejovsky, James E, and Elizabeth Tipton. 2016. "Small Sample Methods for Cluster-Robust Variance Estimation and Hypothesis Testing in Fixed Effects Models." Journal of Business &amp; Economic Statistics. Taylor &amp; Francis. <a href="https://doi.org/10.1080/07350015.2016.1247004" class="external-link">doi:10.1080/07350015.2016.1247004</a>
.</p>
<p>Samii, Cyrus, and Peter M Aronow. 2012. "On Equivalencies Between Design-Based and Regression-Based Variance Estimators for Randomized Experiments." Statistics and Probability Letters 82 (2). <a href="https://doi.org/10.1016/j.spl.2011.10.024" class="external-link">doi:10.1016/j.spl.2011.10.024</a>
.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/fabricatr/" class="external-link">fabricatr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://declaredesign.org/r/fabricatr/reference/fabricate.html" class="external-link">fabricate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  N <span class="op">=</span> <span class="fl">40</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">N</span>, lambda <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Default variance estimator is HC2 robust standard errors</span></span></span>
<span class="r-in"><span><span class="va">lmro</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can tidy() the data in to a data.frame</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lmro</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term   estimate std.error  statistic      p.value   conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)  4.5970879 0.4386909 10.4791036 1.261673e-12  3.7082156 5.4859602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           x  0.1735281 0.3813973  0.4549799 6.517822e-01 -0.5992562 0.9463125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           z -0.9016607 0.5423749 -1.6624308 1.048766e-01 -2.0006166 0.1972952</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 37       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 37       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 37       y</span>
<span class="r-in"><span><span class="co"># Can use summary() to get more statistics</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lmro</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm_robust(formula = y ~ x + z, data = dat)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard error type:  HC2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value  Pr(&gt;|t|) CI Lower CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)   4.5971     0.4387  10.479 1.262e-12   3.7082   5.4860 37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             0.1735     0.3814   0.455 6.518e-01  -0.5993   0.9463 37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z            -0.9017     0.5424  -1.662 1.049e-01  -2.0006   0.1973 37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.05748 ,	Adjusted R-squared:  0.00653 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 1.453 on 2 and 37 DF,  p-value: 0.2468</span>
<span class="r-in"><span><span class="co"># Can also get coefficients three ways</span></span></span>
<span class="r-in"><span><span class="va">lmro</span><span class="op">$</span><span class="va">coefficients</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           x           z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4.5970879   0.1735281  -0.9016607 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmro</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           x           z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4.5970879   0.1735281  -0.9016607 </span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lmro</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  4.5970879  0.1735281 -0.9016607</span>
<span class="r-in"><span><span class="co"># Can also get confidence intervals from object or with new 1 - `alpha`</span></span></span>
<span class="r-in"><span><span class="va">lmro</span><span class="op">$</span><span class="va">conf.low</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           x           z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3.7082156  -0.5992562  -2.0006166 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">lmro</span>, level <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   10 %       90 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.0246601  5.1695157</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -0.3241398  0.6711961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z           -1.6093809 -0.1939405</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can recover classical standard errors</span></span></span>
<span class="r-in"><span><span class="va">lmclassic</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, se_type <span class="op">=</span> <span class="st">"classical"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lmclassic</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term   estimate std.error  statistic      p.value   conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)  4.5970879 0.3802497 12.0896557 2.044110e-14  3.8266288 5.3675470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           x  0.1735281 0.3380391  0.5133374 6.107671e-01 -0.5114042 0.8584604</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           z -0.9016607 0.6184263 -1.4579922 1.532792e-01 -2.1547114 0.3513900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 37       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 37       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 37       y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can easily match Stata's robust standard errors</span></span></span>
<span class="r-in"><span><span class="va">lmstata</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lmstata</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term   estimate std.error  statistic      p.value   conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)  4.5970879 0.4398377 10.4517829 1.356971e-12  3.7058921 5.4882837</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           x  0.1735281 0.3731076  0.4650887 6.445936e-01 -0.5824596 0.9295159</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           z -0.9016607 0.5377414 -1.6767553 1.020208e-01 -1.9912282 0.1879068</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 37       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 37       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 37       y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Easy to specify clusters for cluster-robust inference</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">clusterID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, size <span class="op">=</span> <span class="fl">40</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">lmclust</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, clusters <span class="op">=</span> <span class="va">clusterID</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lmclust</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term   estimate std.error  statistic      p.value   conf.low</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)  4.5970879 0.3915230 11.7415521 7.616489e-05  3.5922426</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           x  0.1735281 0.3018399  0.5749012 5.896636e-01 -0.5966033</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           z -0.9016607 0.4089681 -2.2047214 6.507872e-02 -1.8780217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    conf.high       df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 5.60193322 5.026547       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.94365951 5.127624       y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.07470026 6.685305       y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Can also match Stata's clustered standard errors</span></span></span>
<span class="r-in"><span><span class="fu">lm_robust</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>  clusters <span class="op">=</span> <span class="va">clusterID</span>,</span></span>
<span class="r-in"><span>  se_type <span class="op">=</span> <span class="st">"stata"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error    t value     Pr(&gt;|t|)   CI Lower   CI Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.5970879  0.3942711 11.6597139 2.668545e-06  3.6878972 5.50627862</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            0.1735281  0.3017859  0.5750041 5.810951e-01 -0.5223914 0.86944760</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z           -0.9016607  0.4204547 -2.1444897 6.432503e-02 -1.8712309 0.06790948</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z            8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Works just as LM does with functions in the formula</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">blockID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">blockID</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Estimate Std. Error    t value     Pr(&gt;|t|)   CI Lower</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)       5.0761464  0.7420501  6.8407062 7.125209e-08  3.5681192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x                 0.1905284  0.3731326  0.5106186 6.129177e-01 -0.5677682</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z                -0.6517671  0.5811381 -1.1215355 2.699187e-01 -1.8327818</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(blockID)B -0.1538306  0.9367502 -0.1642173 8.705325e-01 -2.0575361</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(blockID)C -1.0519650  0.9520788 -1.1049138 2.769549e-01 -2.9868220</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(blockID)D -1.0871302  0.8479584 -1.2820561 2.084963e-01 -2.8103891</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)      6.5841735 34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x                0.9488250 34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z                0.5292477 34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(blockID)B 1.7498750 34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(blockID)C 0.8828920 34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> factor(blockID)D 0.6361286 34</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Weights are also easily specified</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">lm_robust</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>  weights <span class="op">=</span> <span class="va">w</span>,</span></span>
<span class="r-in"><span>  clusters <span class="op">=</span> <span class="va">clusterID</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error   t value     Pr(&gt;|t|)   CI Lower  CI Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.5913785  0.4910753  9.349642 0.0003289342  3.3038538 5.8789032</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            0.4028538  0.2133290  1.888416 0.1475001559 -0.2444348 1.0501424</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z           -1.0782068  0.5341716 -2.018465 0.1086801430 -2.5205693 0.3641556</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 4.693802</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           3.279816</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z           4.306669</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Subsetting works just as in `lm()`</span></span></span>
<span class="r-in"><span><span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span>, subset <span class="op">=</span> <span class="va">z</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Estimate Std. Error   t value     Pr(&gt;|t|)  CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.026354  0.3785824 10.635346 1.833544e-07  3.201494 4.8512143 12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -0.462500  0.3599288 -1.284976 2.230493e-01 -1.246718 0.3217174 12</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># One can also choose to set the significance level for different CIs</span></span></span>
<span class="r-in"><span><span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error    t value     Pr(&gt;|t|)   CI Lower   CI Upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  4.5970879  0.4386909 10.4791036 1.261673e-12  3.8569752 5.33720059</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            0.1735281  0.3813973  0.4549799 6.517822e-01 -0.4699248 0.81698110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z           -0.9016607  0.5423749 -1.6624308 1.048766e-01 -1.8166979 0.01337647</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z           37</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can also specify fixed effects</span></span></span>
<span class="r-in"><span><span class="co"># Speed gains with fixed effects are greatest with "stata" or "HC1" std.errors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, fixed_effects <span class="op">=</span> <span class="op">~</span> <span class="va">blockID</span>, se_type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   term   estimate std.error statistic   p.value  conf.low conf.high df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    z -0.5857143 0.5551326 -1.055089 0.2986138 -1.712693 0.5412649 35       y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># Can also use 'margins' or 'emmeans' package if you have them installed</span></span></span>
<span class="r-in"><span>  <span class="co"># to get marginal effects</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/margins" class="external-link">margins</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lmrout</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/margins/man/margins.html" class="external-link">margins</a></span><span class="op">(</span><span class="va">lmrout</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Can output results using 'texreg'</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leifeld/texreg/" class="external-link">texreg</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/texreg/man/texreg.html" class="external-link">texreg</a></span><span class="op">(</span><span class="va">lmrout</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Using emmeans to obtain covariate-adjusted means</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rvlenth.github.io/emmeans/" class="external-link">emmeans</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fiber.rlm</span> <span class="op">&lt;-</span> <span class="fu">lm_robust</span><span class="op">(</span><span class="va">strength</span> <span class="op">~</span> <span class="va">diameter</span> <span class="op">+</span> <span class="va">machine</span>, data <span class="op">=</span> <span class="va">fiber</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rvlenth.github.io/emmeans/reference/emmeans.html" class="external-link">emmeans</a></span><span class="op">(</span><span class="va">fiber.rlm</span>, <span class="st">"machine"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Luke Sonnet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

