<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating discrete random variables with fabricatr • fabricatr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating discrete random variables with fabricatr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fabricatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting_started.html">Getting started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting started with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/building_importing.html">Building and Importing Data</a></li>
    <li><a class="dropdown-item" href="../articles/common_social.html">Common Social Science variables</a></li>
    <li><a class="dropdown-item" href="../articles/cross_classified.html">Panel and Cross-classified data</a></li>
    <li><a class="dropdown-item" href="../articles/resampling.html">Resampling data with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/time_series.html">Time series data with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/variable_generation.html">Generating discrete random variables with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/other_packages.html">Using other data generating packages with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/advanced_features.html">Advanced features</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-software" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Software</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-software">
<li><a class="external-link dropdown-item" href="https://declaredesign.org/r/declaredesign/">DeclareDesign</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/randomizr/">randomizr</a></li>
    <li><a class="dropdown-item" href="https://declaredesign.org/r/fabricatr/">fabricatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/estimatr/">estimatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/designlibrary/">DesignLibrary</a></li>
    <li><a class="external-link dropdown-item" href="https://eos.wzb.eu/ipi/DDWizard/">DesignWizard</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://declaredesign.org">declaredesign.org</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="variable_generation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generating discrete random variables with fabricatr</h1>
                        <h4 data-toc-skip class="author">Aaron Rudkin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DeclareDesign/fabricatr/blob/main/vignettes/variable_generation.Rmd" class="external-link"><code>vignettes/variable_generation.Rmd</code></a></small>
      <div class="d-none name"><code>variable_generation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="fabricating-discrete-random-variables-">Fabricating discrete random variables.<a class="anchor" aria-label="anchor" href="#fabricating-discrete-random-variables-"></a>
</h2>
<p><strong>fabricatr</strong> provides convenient helper functions to generate discrete random variables far more easily than using R’s built-in data generation mechanisms. Below we introduce you to the types of data you can generate using <strong>fabricatr</strong>.</p>
<div class="section level3">
<h3 id="binary-and-binomial-outcomes">Binary and binomial outcomes<a class="anchor" aria-label="anchor" href="#binary-and-binomial-outcomes"></a>
</h3>
<p>The simplest possible type of data is a binary random variable (also called a bernoulli random variable). Generating a binary random variable requires only one parameter <code>prob</code> which specifies the probability that outcomes drawn from this variable are equal to 1. By default, <code><a href="../reference/draw_discrete.html">draw_binary()</a></code> will generate <code>N = length(prob)</code> draws. <code>N</code> can also be specified explicitly. Consider these examples:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draw_binary_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">3</span>, p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  binary_1 <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span>,</span>
<span>  binary_2 <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">3</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In addition to binary variables, you can make data from repeated Bernoulli trials (“binomial” data). This requires using the <code><a href="../reference/draw_discrete.html">draw_binomial()</a></code> function and specifying an argument <code>trials</code>, equal to the number of trials.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binomial_ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  freethrows <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binomial</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, prob <span class="op">=</span> <span class="fl">0.5</span>, trials <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Some researchers may be interested in specifying probabilities through a “link function”. This can be done in any of your data generating functions through the <code>link</code> argument. The default link function is “identity”, but we also support “logit”, and “probit”. These link functions transform continuous and unbounded latent data into probabilities of a positive outcome. If you are specifying a link function, you should also specify your latent variable as the <code>latent</code> argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bernoulli_probit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">3</span>, x <span class="op">=</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>  binary <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>latent <span class="op">=</span> <span class="va">x</span>, link <span class="op">=</span> <span class="st">"probit"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ordered-outcomes">Ordered outcomes<a class="anchor" aria-label="anchor" href="#ordered-outcomes"></a>
</h3>
<p>Some researchers may be interested in generating ordered outcomes – for example, Likert scale outcomes. You can do this with the <code><a href="../reference/draw_discrete.html">draw_ordered()</a></code> function. Ordered variables require a vector of breakpoints, supplied as the argument <code>breaks</code> – points at which the underlying latent variable switches from category to category. The first break should always be below the lower bound of the data, while the final break should always be above the upper bound of the data – if breaks do not cover the data, <code><a href="../reference/draw_discrete.html">draw_ordered()</a></code> will attempt to correct this by adding breaks where appropriate.</p>
<p>In the following example, each of three observations has a latent variable <code>x</code> which is continuous and unbounded. The variable <code>ordered</code> transforms <code>x</code> into three numeric categories: 1, 2, and 3. All values of <code>x</code> below -1 result in <code>ordered</code> 1; all values of <code>x</code> between -1 and 1 result in <code>ordered</code> 2; all values of <code>x</code> above 1 result in <code>ordered</code> 3:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ordered_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  x <span class="op">=</span> <span class="fl">5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>  ordered <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_ordered</a></span><span class="op">(</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="likert-variables">Likert variables<a class="anchor" aria-label="anchor" href="#likert-variables"></a>
</h3>
<p>Likert variables are a special case of ordered variables. Users can use <code><a href="../reference/draw_discrete.html">draw_ordered()</a></code> with properly specified breaks and break labels to generate Likert data, or use the <code><a href="../reference/draw_likert.html">draw_likert()</a></code> function as a convenient alias:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  Q1 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span>, bins <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>  Q2 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span>, bins <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>  Q3 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span>, bins <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/draw_likert.html">draw_likert()</a></code> takes one compulsory argument (<code>x</code>, which represents the latent variable being transformed into ordered data). By default, <code><a href="../reference/draw_likert.html">draw_likert()</a></code> provides a 7-item Likert scale with breaks at [-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>∞</mi><annotation encoding="application/x-tex">\infty</annotation></semantics></math>, -2.5, -1.5, -0.5, 0.5, 1.5, 2.5, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>∞</mi><annotation encoding="application/x-tex">\infty</annotation></semantics></math>]. Users can explicitly specify the <code>type</code> argument to use other types of Likert data. Supported types are 4, 5, and 7. Default breaks for 5-item Likert scales are [-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>∞</mi><annotation encoding="application/x-tex">\infty</annotation></semantics></math>, -1.5, -0.5, 0.5, 1.5, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>∞</mi><annotation encoding="application/x-tex">\infty</annotation></semantics></math>]. Default breaks for 4-item Likert scales are [-<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>∞</mi><annotation encoding="application/x-tex">\infty</annotation></semantics></math>, -1, 0, 1, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>∞</mi><annotation encoding="application/x-tex">\infty</annotation></semantics></math>].</p>
<p>Optionally, users can specify their own breaks. These will override the <code>type</code> command and scale type will be detected based on the length of the <code><a href="https://rdrr.io/r/base/Control.html" class="external-link">break</a></code> argument. As above, a <code><a href="https://rdrr.io/r/base/Control.html" class="external-link">break</a></code> argument with 8 values will produce a 7-item Likert scale, one with 6 values will produce a 5-item Likert scale, and one with 5 values will produce a 4-item Likert scale.</p>
<p>Labels are automatically provided by <code><a href="../reference/draw_likert.html">draw_likert()</a></code>. The default 7-item Likert scale uses the labels [“Strongly Disagree”, “Disagree”, “Lean Disagree”, “Don’t Know / Neutral”, “Lean Agree”, “Agree”, “Strongly Agree”].</p>
<p>Examples of how users might use the function are available below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  Q1 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span>, bins <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>  Q2 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span>, bins <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  Q3 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, max <span class="op">=</span> <span class="fl">5</span>, bins <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Q4 <span class="op">=</span> <span class="fu"><a href="../reference/draw_likert.html">draw_likert</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="op">-</span><span class="fl">0.8</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">$</span><span class="va">Q2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">12</td>
<td align="right">71</td>
<td align="right">17</td>
</tr></tbody>
</table>
<p>This function is a convenient, quick alias for creating likert variables with these labels. Users who want more flexibility with respect to break labels or number of breaks should use <code><a href="../reference/draw_discrete.html">draw_ordered()</a></code> and specify breaks and break labels explicitly.</p>
</div>
<div class="section level3">
<h3 id="ordered-quantile-outcomes-e-g--quartile-decile-etc-">Ordered quantile outcomes (e.g. quartile, decile, etc.)<a class="anchor" aria-label="anchor" href="#ordered-quantile-outcomes-e-g--quartile-decile-etc-"></a>
</h3>
<p>Some variables of interest are modeled as quantile outcomes; for example, income data in a survey might be reported or analyzed by income deciles. We provide two simple helper functions for this purpose: <code><a href="../reference/draw_discrete.html">draw_quantile()</a></code> which allows you to generate quantile outcomes without underlying data, and <code><a href="../reference/split_quantile.html">split_quantile()</a></code> which allows you to transform underlying data into quantile outcomes. This is particularly relevant for survey data that has been made granular to protect respondent privacy.</p>
<p>In this example, we will generate income data for a population and then transform it into deciles:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  income <span class="op">=</span> <span class="fl">20000</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1.4</span>, <span class="fl">0.65</span><span class="op">)</span>,</span>
<span>  income_decile <span class="op">=</span> <span class="fu"><a href="../reference/split_quantile.html">split_quantile</a></span><span class="op">(</span><span class="va">income</span>, type <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>type</code> paramater of the <code><a href="../reference/split_quantile.html">split_quantile()</a></code> function specifies how many bins to split the data into. In the decile example, 10. Note that the resulting quantiles will be based on the sample data, not the parameterization of the population. It would also be possible to skip the step of characterizing the income data by directly modeling income deciles:</p>
<p>This parameterization of the income variable was derived by researching U.S. individual income data and using numerical optimization to derive the parameterization that best approximated a series of quantiles from that data. Many other data generation packages, including <strong>wakefield</strong>, implement automatic generation of income data. For more information about using <strong>fabricatr</strong> with other data generating packages, see <a href="/r/fabricatr/articles/other_packages.html">our online tutorial</a></p>
</div>
<div class="section level3">
<h3 id="count-outcomes">Count outcomes<a class="anchor" aria-label="anchor" href="#count-outcomes"></a>
</h3>
<p><code><a href="../reference/draw_discrete.html">draw_count()</a></code> allows you to create Poisson-distributed count outcomes. These require that the user specify the parameter <code>mean</code>, equal to the Poisson distribution mean (often referred to as <code>lambda</code> in statistical formulations of count data).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_outcome_example</span> <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                                  count <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_count</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="categorical-data">Categorical data<a class="anchor" aria-label="anchor" href="#categorical-data"></a>
</h3>
<p><code><a href="../reference/draw_discrete.html">draw_categorical()</a></code> can generate non-ordered, categorical data. Users must provide a vector of probabilities for each category (or a matrix, if each observation should have separate probabilities).</p>
<p>If probabilities do not sum to exactly one, they will be normalized, but negative probabilities will cause an error.</p>
<p>In the first example, each unit has a different set of probabilities and the probabilities are provided as a matrix:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">categorical_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  p1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  p2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  p3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  cat <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_categorical</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the second example, each unit has the same probability of getting a given category. <code><a href="../reference/draw_discrete.html">draw_categorical()</a></code> will issue a warning to remind you that it is interpreting the vector in this way.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">warn_draw_cat_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  cat <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_categorical</a></span><span class="op">(</span>N <span class="op">=</span> <span class="va">N</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>“categorical” variables can also use link functions, for example to generate multinomial probit data.</p>
</div>
</div>
<div class="section level2">
<h2 id="correlated-random-variables">Correlated random variables<a class="anchor" aria-label="anchor" href="#correlated-random-variables"></a>
</h2>
<p><em>This functionality is EXPERIMENTAL, and we cannot guarantee its properties for all data structures. Be sure to diagnose your design and assess the distributions of your variables.</em></p>
<p><strong>fabricatr</strong> makes it easy to generate correlated random variables one at a time. All you need is a reference variable, a desired rank correlation coefficient (from -1 to 1), and a <code>draw_</code> function to specify the target distribution of the correlated variable.</p>
<p>This is done using a function called <code><a href="../reference/correlate.html">correlate()</a></code>, which takes four distinct arguments: <code>draw_handler</code>, which is the un-quoted name of your desired outcome distribution (e.g. <code>draw_binary</code>, <code>draw_binomial</code>, <code>draw_count</code>); any parameters needed for that distribution (e.g. <code>mean</code> for <code>draw_count</code>); <code>given</code>, which is the reference variable your new variable will be correlated with, and <code>rho</code>, which is the rank correlation coefficient you are targeting.</p>
<p>In this example, we will generate individuals, who are given a battery of public opinion questions. Their responses are aggregated into index scores in each of several categories: conservative values, economic conservatism, and foreign policy interventionism.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">respondents</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  conservative_values <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binomial</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.4</span>, trials <span class="op">=</span> <span class="fl">20</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>  economic_conservative <span class="op">=</span> <span class="fu"><a href="../reference/correlate.html">correlate</a></span><span class="op">(</span>given <span class="op">=</span> <span class="va">conservative_values</span>,</span>
<span>                                    rho <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                    <span class="va">draw_binomial</span>,</span>
<span>                                    prob <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                                    trials <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  foreign_policy <span class="op">=</span> <span class="fu"><a href="../reference/correlate.html">correlate</a></span><span class="op">(</span>given <span class="op">=</span> <span class="va">conservative_values</span>,</span>
<span>                             rho <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                             <span class="va">draw_binomial</span>,</span>
<span>                             prob <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>                             trials <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Unpacking this example; first, the respondents are asked 20 questions and have a 40% chance of answering yes to each question. The result is summed into an index. Next, the respondents are asked 20 questions and have a 60% chance of answering yes to each question, but result is also constrained to be rank-correlated at <code>rho = 0.5</code> with their score on the <code>conservative_values</code> index. Finally, 20 more questions are asked of the respondents about foreign policy, where they have a 40% chance of answering yes, and the index score is somewhat more weakly correlated with <code>conservative_values</code>.</p>
<p>The argument <code>N</code> is not necessary in the resulting distribution because it is automatically detected from the variable specified in <code>given</code>.</p>
<p>We can analyze the data to verify that, subject to the limitations of random sampling, the results reflect the specification. First, let’s verify that our means are approximately 0.4, 0.6, and 0.4:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">respondents</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span> <span class="op">/</span> <span class="fl">20</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">conservative_values</td>
<td align="right">0.42</td>
</tr>
<tr class="even">
<td align="left">economic_conservative</td>
<td align="right">0.60</td>
</tr>
<tr class="odd">
<td align="left">foreign_policy</td>
<td align="right">0.40</td>
</tr>
</tbody>
</table>
<p>Next, let’s check the correlation between our variables of interest:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">respondents</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">conservative_values</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">economic_conservative</td>
<td align="right">0.44</td>
</tr>
<tr class="odd">
<td align="left">foreign_policy</td>
<td align="right">0.24</td>
</tr>
</tbody>
</table>
<p>It is also possible to use <code><a href="../reference/correlate.html">correlate()</a></code> with other variable generation functions, such as those from base <code>R</code> or even custom functions. Custom functions must take an argument <code>quantile_y</code>, which is a vector that supplies quantiles of the distribution to draw from. Base <code>R</code> functions are supported as described here:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">student_report_card</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  math_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="fl">80</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  chemistry_score <span class="op">=</span> <span class="fu"><a href="../reference/correlate.html">correlate</a></span><span class="op">(</span>given <span class="op">=</span> <span class="va">math_score</span>, rho <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                              <span class="va">rnorm</span>, mean <span class="op">=</span> <span class="fl">75</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  civics_score <span class="op">=</span> <span class="fu"><a href="../reference/correlate.html">correlate</a></span><span class="op">(</span>given <span class="op">=</span> <span class="va">math_score</span>, rho <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>                           <span class="va">rnorm</span>, mean <span class="op">=</span> <span class="fl">85</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Please observe that the first argument to correlate, <code>draw_handler</code>, must be supplied as an unquoted name of a variable generating function. By default, this function works with any of the base <code>R</code> distributions; for information about using a third party or custom data generating function, see our <a href="/r/fabricatr/articles/advanced_features.html">advanced features tutorial</a></p>
<p>A note about correlated data: Although the method used will generate data that is correlated on average with rank correlation <code>rho</code>, some variance is normal, and distributions which have less flexibility will be less likely to achieve the target correlation. For example, if the first variable is normally distributed with a wide range of values, and the target variable is a binary 0/1 variable, the correlation will be imprecise by the lack of flexibility in the target variable.</p>
</div>
<div class="section level2">
<h2 id="fabricating-cluster-correlated-random-variables-icc-">Fabricating cluster-correlated random variables (ICC).<a class="anchor" aria-label="anchor" href="#fabricating-cluster-correlated-random-variables-icc-"></a>
</h2>
<p>We also provide helper functions to generate cluster-correlated random variables with fixed intra-cluster correlation (ICC) values. Our two functions <code><a href="../reference/draw_binary_icc.html">draw_binary_icc()</a></code> and <code><a href="../reference/draw_normal_icc.html">draw_normal_icc()</a></code> allow you to generate both discrete binary data with fixed ICCs and normal data with fixed ICCs.</p>
<div class="section level3">
<h3 id="binary-data-with-fixed-iccs">Binary data with fixed ICCs<a class="anchor" aria-label="anchor" href="#binary-data-with-fixed-iccs"></a>
</h3>
<p><code><a href="../reference/draw_binary_icc.html">draw_binary_icc()</a></code> takes three required arguments: <code>prob</code>, a probability or vector of probabilities which determine the chance a given observation will be a 1; <code>clusters</code>, a map of units to clusters (required to generate the correlation structure); and <code>ICC</code>, the fixed intra-cluster correlation (from 0 to 1). Users may optionally specify <code>N</code>; if it is not specified, <code><a href="../reference/draw_binary_icc.html">draw_binary_icc()</a></code> will determine it based on the length of the <code>clusters</code> vector.</p>
<p>Consider the following example, which models whether individuals smoke:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 100 individual population, 20 each in each of 5 clusters</span></span>
<span><span class="va">clusters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Individuals have a 20% chance of smoking, but clusters are highly correlated</span></span>
<span><span class="co"># in their tendency to smoke</span></span>
<span><span class="va">smoker</span> <span class="op">=</span> <span class="fu"><a href="../reference/draw_binary_icc.html">draw_binary_icc</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.2</span>, clusters <span class="op">=</span> <span class="va">clusters</span>, ICC <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Observe distribution of smokers and non-smokers</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">smoker</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">0</th>
<th align="right">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">76</td>
<td align="right">24</td>
</tr></tbody>
</table>
<p>We see that approximately 20% of the population smokes, in line with our specification, but what patterns of heterogeneity do we see by cluster?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">clusters</span>, <span class="va">smoker</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">0</th>
<th align="right">1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">16</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">19</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="right">19</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Here we learn that of our 5 clusters, 4 are overwhelmingly non-smokers, while a fifth is composed of 80% smokers.</p>
<p>We can also specify separate mean for each cluster; but it is worth noting that the higher the ICC, the more the cluster mean will depart from the nominal cluster mean.</p>
<p>If you do not specify a vector of probabilities or a correlation coefficient, the default values are probability 0.5 for each cluster and ICC of 0.5. If you do not specify cluster IDs, the function will return an error.</p>
</div>
<div class="section level3">
<h3 id="normal-data-with-fixed-iccs">Normal data with fixed ICCs<a class="anchor" aria-label="anchor" href="#normal-data-with-fixed-iccs"></a>
</h3>
<p><code><a href="../reference/draw_normal_icc.html">draw_normal_icc()</a></code> takes four required arguments: <code>mean</code>, a mean or vector of means, one for each cluster; <code>clusters</code>, a map of units to clusters (required to generate the correlation structure); <code>ICC</code>, the fixed intra-cluster correlation coefficient; and <code>sd</code>, a standard deviation or vector of standard deviations, one for each cluster. Users can optionally specify <code>N</code>, a number of units, but if it is not supplied <code><a href="../reference/draw_normal_icc.html">draw_normal_icc()</a></code> will determine it based on the length of the <code>clusters</code> vector.</p>
<p>If <code>sd</code> is not supplied, each cluster will be assumed to have a within-cluster standard deviation of 1 and the <code>sd_between</code> will be implied by this <code>sd</code> and the <code>ICC</code> parameter. If <code>mean</code> is not supplied, each cluster will be assumed to be mean zero.</p>
<p>Here, we model student academic performance by cluster:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 100 students, 10 each in 10 clusters</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">numeric_grade</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_normal_icc.html">draw_normal_icc</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">80</span>, clusters <span class="op">=</span> <span class="va">clusters</span>, ICC <span class="op">=</span> <span class="fl">0.5</span>, sd <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">letter_grade</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_ordered</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">numeric_grade</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">60</span>, <span class="fl">70</span>, <span class="fl">80</span>, <span class="fl">90</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  break_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"F"</span>, <span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"A"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">numeric_grade</span><span class="op">)</span></span></code></pre></div>
<p>84.12</p>
<p>The mean grade matches the population mean. Now let’s look at the relationship between cluster and letter grade to observe the cluster pattern:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">letter_grade</span>, <span class="va">clusters</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">F</th>
<th align="right">D</th>
<th align="right">C</th>
<th align="right">B</th>
<th align="right">A</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">3</td>
<td align="right">8</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">7</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">18</td>
</tr>
</tbody>
</table>
<p>It is obvious upon inspection that two of the clusters contain academic high-performers, while two of the clusters have a substantial failure rate. Although each cluster has the same mean in expectation, the induced intra-cluster correlation forces some clusters higher and others lower.</p>
<p>Alternatively, users can specify <code>ICC</code> and <code>total_sd</code>. The resulting variable will be rescaled to have a standard deviation exactly equal to <code>total_sd</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>If you are interested in reading more about how to generate specific variables with <strong>fabricatr</strong>, you can read our tutorial on <a href="/r/fabricatr/articles/common_social.html">common social science variables</a>, or learn how to <a href="/r/fabricatr/articles/other_packages.html">use other data-generating packages with <strong>fabricatr</strong></a>.</p>
<p>If you are interested in learning how to import or build data, you can read our <a href="/r/fabricatr/articles/building_importing.html">introduction to building and importing data</a>. More advanced users can read our tutorial on <a href="/r/fabricatr/articles/cross_classified.html">generating panel or cross-classified data</a>. You can also learn about <a href="/r/fabricatr/articles/resampling.html">bootstrapping and resampling hierarchical data</a>.</p>
</div>
<div class="section level2">
<h2 id="technical-appendix">Technical Appendix<a class="anchor" aria-label="anchor" href="#technical-appendix"></a>
</h2>
<div class="section level3">
<h3 id="correlated-data">Correlated Data<a class="anchor" aria-label="anchor" href="#correlated-data"></a>
</h3>
<p>When generating correlated data using <code><a href="../reference/correlate.html">correlate()</a></code>, the following approach is used, where X is the source variable, F is the empirical distribution of X, G is the target distribution, and Y is the realized variable drawn from that distribution:</p>
<ol style="list-style-type: decimal">
<li>Calculate the quantiles of the observed X in the empirical distribution X</li>
<li>Draw these quantiles from a standard normal distribution</li>
<li>Generate a standard normal version of Y based on the specified relationship.</li>
<li>Map the standard normal Y into the quantiles of the standard normal distribution</li>
<li>Draw from the target distribution at those quantiles.</li>
</ol>
<p>Because all transformations are affine, the rank order correlation induced in the standard normal stage is preserved in the target distribution. Mathematically:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><msub><mi>X</mi><mrow><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi></mrow></msub></mtd><mtd columnalign="left"><mo>=</mo><msup><mi>F</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false" form="prefix">(</mo><mi>X</mi><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>X</mi><mrow><mi>s</mi><mi>t</mi><mi>d</mi></mrow></msub></mtd><mtd columnalign="left"><mo>=</mo><mi>Φ</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>X</mi><mrow><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>Y</mi><mrow><mi>s</mi><mi>t</mi><mi>d</mi></mrow></msub></mtd><mtd columnalign="left"><mo>∼</mo><mi>N</mi><mo stretchy="false" form="prefix">(</mo><mi>ρ</mi><mo>×</mo><msub><mi>X</mi><mrow><mi>s</mi><mi>t</mi><mi>d</mi></mrow></msub><mo>,</mo><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><msup><mi>ρ</mi><mn>2</mn></msup><mo stretchy="false" form="postfix">)</mo><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>Y</mi><mrow><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi></mrow></msub></mtd><mtd columnalign="left"><mo>=</mo><msup><mi>Φ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false" form="prefix">(</mo><msub><mi>Y</mi><mrow><mi>s</mi><mi>t</mi><mi>d</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><mi>Y</mi></mtd><mtd columnalign="left"><mo>=</mo><mi>G</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>Y</mi><mrow><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  X_{quan} &amp;= F^{-1}(X) \\
  X_{std} &amp;= \Phi(X_{quan}) \\
  Y_{std} &amp;\sim N(\rho \times X_{std}, (1 - \rho^2)) \\
  Y_{quan} &amp;= \Phi^{-1}(Y_{std}) \\
  Y &amp;= G(Y_{quan})
\end{aligned}
</annotation></semantics></math></p>
<p>One thing that may be counterintuitive about this approach is that the correlation is based on the sample characteristics of X – the empirical data X observed without reference to its distribution of origin – but the population characteristics of Y. This choice was chosen because it minimizes the amount of information required of users and maximizes the flexibility of source variables, although it may result in some imprecision on a given draw owing to the finite sample size of X (or chance deviation of X from the desired distribution during sampling).</p>
</div>
<div class="section level3">
<h3 id="binary-icc">Binary ICC<a class="anchor" aria-label="anchor" href="#binary-icc"></a>
</h3>
<p>When generating binary data with a fixed ICC, we use this formula, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> is a cluster and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math> is a unit in a cluster:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><msub><mi>z</mi><mi>i</mi></msub></mtd><mtd columnalign="left"><mo>∼</mo><mtext mathvariant="normal">Bern</mtext><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd><mtd columnalign="left"><mo>∼</mo><mtext mathvariant="normal">Bern</mtext><mo stretchy="false" form="prefix">(</mo><msqrt><mi>ρ</mi></msqrt><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd><mtd columnalign="left"><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left"><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∼</mo><mtext mathvariant="normal">Bern</mtext><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">)</mo></mtd><mtd columnalign="left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left"><msub><mi>z</mi><mi>i</mi></msub></mtd><mtd columnalign="left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>u</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn></mtd></mtr></mtable></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  z_i &amp;\sim \text{Bern}(p_i) \\
  u_{ij} &amp;\sim \text{Bern}(\sqrt{\rho}) \\
  x_{ij} &amp;=
  \begin{cases}
    x_{ij} \sim \text{Bern}(p_i) &amp; \quad \text{if } u_{ij} = 1 \\
    z_i &amp; \quad \text{if } u_{ij} = 0
  \end{cases}
\end{aligned}
</annotation></semantics></math></p>
<p>In expectation, this guarantees an intra-cluster correlation of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math> and a cluster proportion of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>i</mi></msub><annotation encoding="application/x-tex">p_i</annotation></semantics></math>. This approach is derived from Hossain, Akhtar and Chakraborti, Hrishikesh. “ICCBin: Facilitates Clustered Binary Data Generation, and Estimation of Intracluster Correlation Coefficient (ICC) for Binary Data”, available on <a href="https://cran.r-project.org/package=ICCbin" class="external-link">CRAN</a> or <a href="https://github.com/akhtarh/ICCbin" class="external-link">GitHub</a></p>
</div>
<div class="section level3">
<h3 id="normal-icc">Normal ICC<a class="anchor" aria-label="anchor" href="#normal-icc"></a>
</h3>
<p>When generating normal data with a fixed ICC, we follow this formula, again with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> as a cluster and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math> as a unit in the cluster:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><msubsup><mi>σ</mi><mrow><mi>α</mi><mi>i</mi></mrow><mn>2</mn></msubsup></mtd><mtd columnalign="left"><mo>=</mo><mfrac><mrow><mo stretchy="false" form="prefix">(</mo><mi>ρ</mi><mo>*</mo><msubsup><mi>σ</mi><mrow><mi>ϵ</mi><mi>i</mi></mrow><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo></mrow><mrow><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ρ</mi><mo stretchy="false" form="postfix">)</mo></mrow></mfrac></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>α</mi><mi>i</mi></msub></mtd><mtd columnalign="left"><mo>∼</mo><mstyle mathvariant="script"><mi>𝒩</mi></mstyle><mo stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>σ</mi><mrow><mi>α</mi><mi>i</mi></mrow><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>μ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd><mtd columnalign="left"><mo>∼</mo><mstyle mathvariant="script"><mi>𝒩</mi></mstyle><mo stretchy="false" form="prefix">(</mo><msub><mi>μ</mi><mi>i</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mrow><mi>ϵ</mi><mi>i</mi></mrow><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"><msub><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd><mtd columnalign="left"><mo>=</mo><msub><mi>μ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>α</mi><mi>i</mi></msub></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  \sigma^2_{\alpha i} &amp;= \frac{(\rho * \sigma^2_{\epsilon i})}{(1 - \rho)} \\
  \alpha_i &amp;\sim \mathcal{N}(0, \sigma^2_{\alpha i}) \\
  \mu_{ij} &amp;\sim \mathcal{N}(\mu_i, \sigma^2_{\epsilon i}) \\
  x_{ij} &amp;= \mu_{ij} + \alpha_i
\end{aligned}
</annotation></semantics></math></p>
<p>In expectation, this approach guarantees an intra-cluster correlation of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>, a cluster mean of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mu_{i}</annotation></semantics></math>, and a cluster-level variance in error terms of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mrow><mi>ϵ</mi><mi>i</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_{\epsilon i}</annotation></semantics></math>. This approach is specified on <a href="https://stats.stackexchange.com/questions/263451/create-synthetic-data-with-a-given-intraclass-correlation-coefficient-icc" class="external-link">StatsExchange</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Aaron Rudkin, Neal Fultz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
