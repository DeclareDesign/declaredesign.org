<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Building and Importing Data • fabricatr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Building and Importing Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fabricatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/getting_started.html">Getting started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting_started.html">Getting started with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/building_importing.html">Building and Importing Data</a></li>
    <li><a class="dropdown-item" href="../articles/common_social.html">Common Social Science variables</a></li>
    <li><a class="dropdown-item" href="../articles/cross_classified.html">Panel and Cross-classified data</a></li>
    <li><a class="dropdown-item" href="../articles/resampling.html">Resampling data with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/time_series.html">Time series data with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/variable_generation.html">Generating discrete random variables with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/other_packages.html">Using other data generating packages with fabricatr</a></li>
    <li><a class="dropdown-item" href="../articles/advanced_features.html">Advanced features</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-software" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Software</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-software">
<li><a class="external-link dropdown-item" href="https://declaredesign.org/r/declaredesign/">DeclareDesign</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/randomizr/">randomizr</a></li>
    <li><a class="dropdown-item" href="https://declaredesign.org/r/fabricatr/">fabricatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/estimatr/">estimatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/rdss/">rdss</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/designlibrary/">DesignLibrary</a></li>
    <li><a class="external-link dropdown-item" href="https://eos.wzb.eu/ipi/DDWizard/">DesignWizard</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://declaredesign.org">declaredesign.org</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="building_importing_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Building and Importing Data</h1>
                        <h4 data-toc-skip class="author">Aaron Rudkin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DeclareDesign/fabricatr/blob/main/vignettes/building_importing.Rmd" class="external-link"><code>vignettes/building_importing.Rmd</code></a></small>
      <div class="d-none name"><code>building_importing.Rmd</code></div>
    </div>

    
    
<p><strong>fabricatr</strong> is a package designed to help you imagine your data before you collect it. While many solutions exist for creating simulated datasets, <strong>fabricatr</strong> is specifically designed to make the creation of realistic social science datasets easy. In particular, we need to be able to imagine <em>correlated</em> data and <em>hierarchical</em> data.</p>
<div class="section level2">
<h2 id="basics">Basics<a class="anchor" aria-label="anchor" href="#basics"></a>
</h2>
<p>Using <strong>fabricatr</strong> begins by calling the function <code><a href="../reference/fabricate.html">fabricate()</a></code>. <code><a href="../reference/fabricate.html">fabricate()</a></code> can be used to create single-level of hierarchical data. There are three main ways to call <code><a href="../reference/fabricate.html">fabricate()</a></code>:</p>
<ul>
<li>Making a single-level dataset by specifying how many observations you would like</li>
<li>Making a single-level dataset by importing data and optionally modifying it by creating new variables</li>
<li>Making a hierarchical dataset.</li>
</ul>
</div>
<div class="section level2">
<h2 id="single-level-datasets-from-scratch">Single-level datasets from scratch<a class="anchor" aria-label="anchor" href="#single-level-datasets-from-scratch"></a>
</h2>
<p>Making a single-level dataset begins with providing the argument <code>N</code>, a number representing the number of observations you wish to create, followed by a series of variable definitions. Variables can be defined using any function you have access to in R. <strong>fabricatr</strong> provides several simple functions for generating common types of data. These are covered below. Functions that create subsequent variables can rely on previously created variables, which ensures that variables can be related to one another:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/fabricatr/">fabricatr</a></span><span class="op">)</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">5</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, Y2 <span class="op">=</span> <span class="va">Y</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">my_data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="right">Y</th>
<th align="right">Y2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">0.78</td>
<td align="right">3.9</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">0.50</td>
<td align="right">2.5</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">0.54</td>
<td align="right">2.7</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">0.61</td>
<td align="right">3.0</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="right">0.32</td>
<td align="right">1.6</td>
</tr>
</tbody>
</table>
<p>This simple example makes use of <code>R</code>’s built-in <code>runif</code> command. The rest of the tutorial assumes a familiarity with <code>R</code> and its basic data generating processes.</p>
</div>
<div class="section level2">
<h2 id="filling-out-observations-">Filling out observations.<a class="anchor" aria-label="anchor" href="#filling-out-observations-"></a>
</h2>
<p><code>fabricate</code> is intended to make rectangular data frames: this means that each variable added at a level needs to be the same length. Failure to provide equal-length variables will result in an error. We provide a convenient helper function, <code>recycle</code>, to help expand existing data to fit the length of your level. Here, let’s use the existing <code>month</code> variable from <code>R</code> to generate data using a month:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">month_gdp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  month_name <span class="op">=</span> <span class="fu"><a href="../reference/recycle.html">recycle</a></span><span class="op">(</span><span class="va">month.abb</span><span class="op">)</span>,</span>
<span>  gdp_growth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><code>month.abb</code> contains the months of the year: [“Jan”, “Feb”, “Mar”, …, “Dec”]. It is obvious that although we are asking for 20 observations, there are only twelve months in the year. <code>recycle</code> will automatically wrap the month text resulting in a data frame with the 12 months “Jan” through “Dec”, followed by 8 months “Jan” through “Aug”.</p>
</div>
<div class="section level2">
<h2 id="single-level-datasets-using-existing-data">Single-level datasets using existing data<a class="anchor" aria-label="anchor" href="#single-level-datasets-using-existing-data"></a>
</h2>
<p>Instead of specifying the argument <code>N</code>, users can specify the argument <code>data</code> to import existing datasets. Once a dataset is imported, subsequent variables have access to <code>N</code>, representing the number of observations in the imported data. This makes it easy to augment existing data with simulations based on that data.</p>
<p>In this example, we make use of the <code>quakes</code> dataset, built into <code>R</code>, which describes characteristics of earthquakes off the coast of Fiji. The <code>mag</code> variable in this dataset contains the richter magnitude of the earthquakes. We will expand this data to add variables modelling hypothetical fatalities and insurance costs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulated_quake_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">quakes</span>,</span>
<span>  fatalities <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="va">mag</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  insurance_cost <span class="op">=</span> <span class="va">fatalities</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1000000</span>, <span class="fl">2000000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">simulated_quake_data</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">lat</th>
<th align="right">long</th>
<th align="right">depth</th>
<th align="right">mag</th>
<th align="right">stations</th>
<th align="right">fatalities</th>
<th align="right">insurance_cost</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-20</td>
<td align="right">182</td>
<td align="right">562</td>
<td align="right">4.8</td>
<td align="right">41</td>
<td align="right">494</td>
<td align="right">564,736,181</td>
</tr>
<tr class="even">
<td align="right">-21</td>
<td align="right">181</td>
<td align="right">650</td>
<td align="right">4.2</td>
<td align="right">15</td>
<td align="right">390</td>
<td align="right">414,044,159</td>
</tr>
<tr class="odd">
<td align="right">-26</td>
<td align="right">184</td>
<td align="right">42</td>
<td align="right">5.4</td>
<td align="right">43</td>
<td align="right">596</td>
<td align="right">708,701,956</td>
</tr>
<tr class="even">
<td align="right">-18</td>
<td align="right">182</td>
<td align="right">626</td>
<td align="right">4.1</td>
<td align="right">19</td>
<td align="right">293</td>
<td align="right">567,537,664</td>
</tr>
<tr class="odd">
<td align="right">-20</td>
<td align="right">182</td>
<td align="right">649</td>
<td align="right">4.0</td>
<td align="right">11</td>
<td align="right">487</td>
<td align="right">920,442,976</td>
</tr>
<tr class="even">
<td align="right">-20</td>
<td align="right">184</td>
<td align="right">195</td>
<td align="right">4.0</td>
<td align="right">12</td>
<td align="right">319</td>
<td align="right">436,673,133</td>
</tr>
</tbody>
</table>
<p>Notice that variable creation calls are able to make reference to both the variables in the imported data set, and newly created variables. Also, function calls can be arbitrarily nested – the variable fatalities uses several nested function calls.</p>
</div>
<div class="section level2">
<h2 id="hierarchical-data">Hierarchical data<a class="anchor" aria-label="anchor" href="#hierarchical-data"></a>
</h2>
<p>The most powerful use of <strong>fabricatr</strong> is to create hierarchical (“nested”) data. In the example below, we create 5 countries, each of which has 10 provinces. We also have covariates at the country level (GDP per capita and life expectancy) and at the provincial level (presence of natural resources, and presence of manufacturing industry):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">country_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    countries <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      gdp_per_capita <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, min <span class="op">=</span> <span class="fl">10000</span>, max <span class="op">=</span> <span class="fl">50000</span><span class="op">)</span>,</span>
<span>      life_expectancy <span class="op">=</span> <span class="fl">50</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="va">gdp_per_capita</span> <span class="op">&gt;</span> <span class="fl">30000</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    provinces <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      natural_resources <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.3</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,</span>
<span>      manufacturing <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span>prob <span class="op">=</span> <span class="fl">0.7</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">country_data</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="18%">
<col width="19%">
<col width="12%">
<col width="21%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">countries</th>
<th align="right">gdp_per_capita</th>
<th align="right">life_expectancy</th>
<th align="left">provinces</th>
<th align="right">natural_resources</th>
<th align="right">manufacturing</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">02</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">03</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">04</td>
<td align="right">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">05</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">06</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Several things can be observed in this example. First, fabricate knows that your second <code><a href="../reference/fabricate.html">add_level()</a></code> command will be nested under the first level of data. Each level gets its own ID variable, in addition to the variables you create. Second, the meaning of the variable “N” changes. During the <code><a href="../reference/fabricate.html">add_level()</a></code> call for countries, N is 5. During the <code><a href="../reference/fabricate.html">add_level()</a></code> call for provinces, N is 10. And the resulting data, of course, has 50 observations.</p>
<p>Finally, the province-level variables are created using the <code><a href="../reference/draw_discrete.html">draw_binary()</a></code> function. This is a function provided by <strong>fabricatr</strong> to make simulating discrete random variables simple. When you simulate your own data, you can use <strong>fabricatr</strong>’s functions, R’s built-ins, or any custom functions you wish. <code><a href="../reference/draw_discrete.html">draw_binary()</a></code> is explained in <a href="/r/fabricatr/articles/variable_generation.html">our tutorial on variable generation using <strong>fabricatr</strong></a></p>
</div>
<div class="section level2">
<h2 id="adding-hierarchy-to-existing-data">Adding hierarchy to existing data<a class="anchor" aria-label="anchor" href="#adding-hierarchy-to-existing-data"></a>
</h2>
<p><strong>fabricatr</strong> is also able to import existing data and nest hierarchical data under it. This maybe be useful if, for example, you have existing country-level data but wish to simulate data at lower geographical levels for the purposes of an experiment you plan to conduct.</p>
<p>Imagine importing the country-province data simulated in the previous example. Because <code><a href="../reference/fabricate.html">fabricate()</a></code> returns a data frame, this simulated data can be re-imported into a subsequent fabricate call, just like external data can be.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">citizen_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">country_data</span>,</span>
<span>    citizens <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">10</span>,</span>
<span>      salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span></span>
<span>        <span class="va">N</span>,</span>
<span>        mean <span class="op">=</span> <span class="va">gdp_per_capita</span> <span class="op">+</span> <span class="va">natural_resources</span> <span class="op">*</span> <span class="fl">5000</span> <span class="op">+</span> <span class="va">manufacturing</span> <span class="op">*</span> <span class="fl">5000</span>,</span>
<span>        sd <span class="op">=</span> <span class="fl">10000</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">citizen_data</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="15%">
<col width="16%">
<col width="10%">
<col width="18%">
<col width="14%">
<col width="9%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">countries</th>
<th align="right">gdp_per_capita</th>
<th align="right">life_expectancy</th>
<th align="left">provinces</th>
<th align="right">natural_resources</th>
<th align="right">manufacturing</th>
<th align="left">citizens</th>
<th align="right">salary</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">001</td>
<td align="right">45,852</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">002</td>
<td align="right">56,768</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">003</td>
<td align="right">52,549</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">004</td>
<td align="right">46,428</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">005</td>
<td align="right">70,148</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">006</td>
<td align="right">64,771</td>
</tr>
</tbody>
</table>
<p>In this example, we add a third level of data; for each of our 50 country-province observations, we now have 10 citizen-level observations. Citizen-level covariates like salary can draw from both the country-level covariate and the province-level covariate.</p>
<p>Notice that the syntax for adding a new nested level to existing data is different than the syntax for adding new variables to the original dataset.</p>
</div>
<div class="section level2">
<h2 id="modifying-existing-levels">Modifying existing levels<a class="anchor" aria-label="anchor" href="#modifying-existing-levels"></a>
</h2>
<p>Suppose you have hierarchical data, and wish to simulate variables at a higher level of aggregation. For example, imagine you import a dataset containing citizens within countries, but you wish to simulate additional country-level variables. In <strong>fabricatr</strong>, you can do this using the <code><a href="../reference/fabricate.html">modify_level()</a></code> command.</p>
<p>Let’s use our country-province data from earlier:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_country_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">country_data</span>,</span>
<span>    countries <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">modify_level</a></span><span class="op">(</span>average_temperature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">30</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_country_data</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="9%">
<col width="14%">
<col width="15%">
<col width="9%">
<col width="17%">
<col width="13%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th align="left">countries</th>
<th align="right">gdp_per_capita</th>
<th align="right">life_expectancy</th>
<th align="left">provinces</th>
<th align="right">natural_resources</th>
<th align="right">manufacturing</th>
<th align="right">average_temperature</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">01</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">02</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">52</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">03</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">69</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">04</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">64</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">05</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">33</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">40,451</td>
<td align="right">73</td>
<td align="left">06</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">65</td>
</tr>
</tbody>
</table>
<p>We can observe that the new variable is created at the level of aggregation you chose – countries. Also, although N is not specified anywhere, <code><a href="../reference/fabricate.html">modify_level()</a></code> knows how large N should be based on the number of countries it finds in the dataset. It is important, then, to ensure that the <code><a href="../reference/fabricate.html">modify_level()</a></code> command is correctly assigned to the level of interest. We can also modify more than one level.</p>
<p>Here, we modify our country-province-citizen data from above:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_citizen_data</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">citizen_data</span>,</span>
<span>    countries <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">modify_level</a></span><span class="op">(</span>average_temperature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">30</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    provinces <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">modify_level</a></span><span class="op">(</span></span>
<span>      conflict_zone <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span><span class="va">N</span>, prob <span class="op">=</span> <span class="fl">0.2</span> <span class="op">+</span> <span class="va">natural_resources</span> <span class="op">*</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>      infant_mortality <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="va">conflict_zone</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span></span>
<span>        <span class="op">(</span><span class="va">average_temperature</span> <span class="op">&gt;</span> <span class="fl">70</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span></span>
<span>    <span class="op">)</span>,</span>
<span>    citizens <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">modify_level</a></span><span class="op">(</span></span>
<span>      college_degree <span class="op">=</span> <span class="fu"><a href="../reference/draw_discrete.html">draw_binary</a></span><span class="op">(</span><span class="va">N</span>, prob <span class="op">=</span> <span class="fl">0.4</span> <span class="op">-</span> <span class="op">(</span><span class="fl">0.3</span> <span class="op">*</span> <span class="va">conflict_zone</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Before assessing what this tells us about <code><a href="../reference/fabricate.html">modify_level()</a></code>, let’s consider what the data simulated does. It creates a new variable at the country level, for a country level average temperature. Subsequently, it creates a province level binary indicator for whether the province is an active conflict site. Provinces that have natural resources are more likely to be in conflict in this simulation, drawing on conclusions from literature on “resource curses”. The infant mortality rate for the province is able to depend both on province level data we have just generated, and country-level data: it is higher in high-temperature areas (reflecting literature on increased disease burden near the equator) and also higher in conflict zones. Citizen access to education is also random, but depends on whether they live in a conflict area.</p>
<p>There are a lot of things to learn from this example. First, it’s possible to modify multiple levels. Any new variable created will automatically propagate to the lower level data according – by setting an average temperature for a country, all provinces, and all citizens of those provinces, have the value for the country. Values created from one <code><a href="../reference/fabricate.html">modify_level()</a></code> call can be used in subsequent variables of the same call, or subsequent calls.</p>
<p>Again, we see the use of <code><a href="../reference/draw_discrete.html">draw_binary()</a></code>. Using this function is covered in our tutorial on <a href="/r/fabricatr/articles/variable_generation.html">generating discrete random variables</a>, linked below.</p>
</div>
<div class="section level2">
<h2 id="averages-within-higher-levels-of-hierarchy">Averages within higher levels of hierarchy<a class="anchor" aria-label="anchor" href="#averages-within-higher-levels-of-hierarchy"></a>
</h2>
<p>A powerful feature of nested data and <strong>fabricatr</strong>’s setup is that variable creating can access variables from higher in</p>
<p>You may want to include the mean value of a variable within a group defined by a higher level of the hierarchy, for example the average income of citizens within city. You can do this with <code><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave()</a></code>, a built-in <code>R</code> command:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ave_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fabricate.html">fabricate</a></span><span class="op">(</span></span>
<span>  cities <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">add_level</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  citizens <span class="op">=</span> <span class="fu"><a href="../reference/fabricate.html">add_level</a></span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>    income_mean_city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">cities</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ave_example</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">cities</th>
<th align="left">citizens</th>
<th align="right">income</th>
<th align="right">income_mean_city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1</td>
<td align="right">-1.39</td>
<td align="right">-1.39</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">2</td>
<td align="right">-0.16</td>
<td align="right">0.73</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">3</td>
<td align="right">1.62</td>
<td align="right">0.73</td>
</tr>
</tbody>
</table>
<p>Here, we can create citizen-level data which relies on the data of other citizens within the same city. <code><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave()</a></code> takes two arguments: first, the name of the variable we are averaging on (in this case, <code>income</code>), and second, the name of the level we are grouping by (in this case <code>cities</code>). Other <code>R</code> functions which are able to group by variables to compute statistics of interest are also compatible with <strong>fabricatr</strong>.</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>You’ve seen <strong>fabricatr</strong>’s ability to generate single-level and hierarchical data, which is enough to get you started on using the package. From here, you can explore more about modeling the structure of data by reading our <a href="/r/fabricatr/articles/cross_classified.html">tutorial on panel and cross-classified data</a> or <a href="/r/fabricatr/articles/resampling.html">using <strong>fabricatr</strong> to bootstrap or resample hierarchical data</a>. Or, if you would like to learn about modeling specific variables using <strong>fabricatr</strong>, you can read our tutorial on <a href="/r/fabricatr/articles/common_social.html">common social science variables</a>; our technical manual on <a href="/r/fabricatr/articles/variable_generation.html">generating discrete random variables</a>; or our guide on <a href="/r/fabricatr/articles/other_packages.html">using other data generation packages</a> with <strong>fabricatr</strong>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Aaron Rudkin, Neal Fultz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
