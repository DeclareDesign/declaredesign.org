<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Horvitz-Thompson estimator for two-armed trials — horvitz_thompson • estimatr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Horvitz-Thompson estimator for two-armed trials — horvitz_thompson"><meta name="description" content="Horvitz-Thompson estimators that are unbiased for designs in
which the randomization scheme is known"><meta property="og:description" content="Horvitz-Thompson estimators that are unbiased for designs in
which the randomization scheme is known"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">estimatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting started using estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/absorbing-fixed-effects.html">Absorbing Fixed Effects with estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/estimatr-in-the-tidyverse.html">estimatr in the Tidyverse</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-estimatr.html">Benchmarking estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/emmeans-examples.html">Examples with emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/mathematical-notes.html">Mathematical notes for estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/regression-tables.html">Regression Tables with estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/simulations-debiasing-dim.html">Simulations - Debiasing Difference-in-Means</a></li>
    <li><a class="dropdown-item" href="../articles/simulations-ols-variance.html">Simulations - OLS and Variance</a></li>
    <li><a class="dropdown-item" href="../articles/stata-wls-hat.html">How Stata's hat matrix differs with weights</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-software" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Software</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-software"><li><a class="external-link dropdown-item" href="http://declaredesign.org/r/declaredesign/">DeclareDesign</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/randomizr/">randomizr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/fabricatr/">fabricatr</a></li>
    <li><a class="dropdown-item" href="https://declaredesign.org/r/estimatr/">estimatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/designlibrary/">DesignLibrary</a></li>
    <li><a class="external-link dropdown-item" href="https://eos.wzb.eu/ipi/DDWizard/">DesignWizard</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://declaredesign.org">declaredesign.org</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Horvitz-Thompson estimator for two-armed trials</h1>
      <small class="dont-index">Source: <a href="https://github.com/DeclareDesign/estimatr/blob/main/R/estimatr_horvitz_thompson.R" class="external-link"><code>R/estimatr_horvitz_thompson.R</code></a></small>
      <div class="d-none name"><code>horvitz_thompson.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Horvitz-Thompson estimators that are unbiased for designs in
which the randomization scheme is known</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">horvitz_thompson</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">blocks</span>,</span>
<span>  <span class="va">clusters</span>,</span>
<span>  simple <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">condition_prs</span>,</span>
<span>  condition_pr_mat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ra_declaration <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  condition1 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  condition2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  se_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"youngs"</span>, <span class="st">"constant"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  ci <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  return_condition_pr_mat <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>an object of class formula, as in <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>, such as
<code>Y ~ Z</code> with only one variable on the right-hand side, the treatment.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data.frame.</p></dd>


<dt id="arg-blocks">blocks<a class="anchor" aria-label="anchor" href="#arg-blocks"></a></dt>
<dd><p>An optional bare (unquoted) name of the block variable. Use
for blocked designs only. See details.</p></dd>


<dt id="arg-clusters">clusters<a class="anchor" aria-label="anchor" href="#arg-clusters"></a></dt>
<dd><p>An optional bare (unquoted) name of the variable that
corresponds to the clusters in the data; used for cluster randomized
designs. For blocked designs, clusters must be within blocks.</p></dd>


<dt id="arg-simple">simple<a class="anchor" aria-label="anchor" href="#arg-simple"></a></dt>
<dd><p>logical, optional. Whether the randomization is simple
(TRUE) or complete (FALSE). This is ignored if <code>blocks</code> are specified,
as all blocked designs use complete randomization, or either
<code>ra_declaration</code> or <code>condition_pr_mat</code> are passed. Otherwise, it
defaults to <code>TRUE</code>.</p></dd>


<dt id="arg-condition-prs">condition_prs<a class="anchor" aria-label="anchor" href="#arg-condition-prs"></a></dt>
<dd><p>An optional bare (unquoted) name of the variable with
the condition 2 (treatment) probabilities. See details. May also use a single
number for the condition 2 probability if it is constant.</p></dd>


<dt id="arg-condition-pr-mat">condition_pr_mat<a class="anchor" aria-label="anchor" href="#arg-condition-pr-mat"></a></dt>
<dd><p>An optional 2n * 2n matrix of marginal and joint
probabilities of all units in condition1 and condition2. See details.</p></dd>


<dt id="arg-ra-declaration">ra_declaration<a class="anchor" aria-label="anchor" href="#arg-ra-declaration"></a></dt>
<dd><p>An object of class <code>"ra_declaration"</code>, from
the <code><a href="https://rdrr.io/pkg/randomizr/man/declare_ra.html" class="external-link">declare_ra</a></code> function in the <span class="pkg">randomizr</span>
package. This is the third way that one can specify a design for this
estimator. Cannot be used along with any of <code>condition_prs</code>,
<code>blocks</code>, <code>clusters</code>, or <code>condition_pr_mat</code>. See details.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>An optional bare (unquoted) expression specifying a subset of
observations to be used.</p></dd>


<dt id="arg-condition-">condition1<a class="anchor" aria-label="anchor" href="#arg-condition-"></a></dt>
<dd><p>value in the treatment vector of the condition
to be the control. Effects are
estimated with <code>condition1</code> as the control and <code>condition2</code> as the
treatment. If unspecified, <code>condition1</code> is the "first" condition and
<code>condition2</code> is the "second" according to levels if the treatment is a
factor or according to a sortif it is a numeric or character variable (i.e
if unspecified and the treatment is 0s and 1s, <code>condition1</code> will by
default be 0 and <code>condition2</code> will be 1). See the examples for more.</p></dd>


<dt id="arg-condition-">condition2<a class="anchor" aria-label="anchor" href="#arg-condition-"></a></dt>
<dd><p>value in the treatment vector of the condition to be the
treatment. See <code>condition1</code>.</p></dd>


<dt id="arg-se-type">se_type<a class="anchor" aria-label="anchor" href="#arg-se-type"></a></dt>
<dd><p>can be one of <code>c("youngs", "constant", "none")</code> and corresponds
the estimator of the standard errors. Default estimator uses Young's
inequality (and is conservative) while the other uses a constant treatment
effects assumption and only works for simple randomized designs at the
moment. If "none" then standard errors will not be computed which may speed up run time if only the point estimate is required.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>logical. Whether to compute and return p-values and
confidence intervals, TRUE by default.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>The significance level, 0.05 by default.</p></dd>


<dt id="arg-return-condition-pr-mat">return_condition_pr_mat<a class="anchor" aria-label="anchor" href="#arg-return-condition-pr-mat"></a></dt>
<dd><p>logical. Whether to return the condition
probability matrix. Returns NULL if the design is simple randomization,
FALSE by default.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns an object of class <code>"horvitz_thompson"</code>.</p>
<p>The post-estimation commands functions <code>summary</code> and <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></code>
return results in a <code>data.frame</code>. To get useful data out of the return,
you can use these data frames, you can use the resulting list directly, or
you can use the generic accessor functions <code>coef</code> and
<code>confint</code>.</p>
<p>An object of class <code>"horvitz_thompson"</code> is a list containing at
least the following components:</p>
<p></p>
<dl><dt>coefficients</dt>
<dd><p>the estimated difference in totals</p></dd>

  <dt>std.error</dt>
<dd><p>the estimated standard error</p></dd>

  <dt>statistic</dt>
<dd><p>the z-statistic</p></dd>

  <dt>df</dt>
<dd><p>the estimated degrees of freedom</p></dd>

  <dt>p.value</dt>
<dd><p>the p-value from a two-sided z-test using <code>coefficients</code> and <code>std.error</code></p></dd>

  <dt>conf.low</dt>
<dd><p>the lower bound of the <code>1 - alpha</code> percent confidence interval</p></dd>

  <dt>conf.high</dt>
<dd><p>the upper bound of the <code>1 - alpha</code> percent confidence interval</p></dd>

  <dt>term</dt>
<dd><p>a character vector of coefficient names</p></dd>

  <dt>alpha</dt>
<dd><p>the significance level specified by the user</p></dd>

  <dt>nobs</dt>
<dd><p>the number of observations used</p></dd>

  <dt>outcome</dt>
<dd><p>the name of the outcome variable</p></dd>

  <dt>condition_pr_mat</dt>
<dd><p>the condition probability matrix if <code>return_condition_pr_mat</code> is TRUE</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function implements the Horvitz-Thompson estimator for
treatment effects for two-armed trials. This estimator is useful for estimating unbiased
treatment effects given any randomization scheme as long as the
randomization scheme is known.</p>
<p>In short, the Horvitz-Thompson estimator essentially reweights each unit
by the probability of it being in its observed condition. Pivotal to the
estimation of treatment effects using this estimator are the marginal
condition probabilities (i.e., the probability that any one unit is in
a particular treatment condition). Pivotal to the estimating the variance
variance whenever the design is more complicated than simple randomization,
are the
joint condition probabilities (i.e., the probabilities that any two units
have a particular set of treatment conditions, either the same or
different). The estimator we provide here considers the case with two
treatment conditions.</p>
<p>Users interested in more details can see the
<a href="https://declaredesign.org/r/estimatr/articles/mathematical-notes.html">mathematical notes</a>
for more information and references, or see the references below.</p>
<p>There are three distinct ways that users can specify the design to the
function. The preferred way is to use
the <code><a href="https://rdrr.io/pkg/randomizr/man/declare_ra.html" class="external-link">declare_ra</a></code> function in the <span class="pkg">randomizr</span>
package. This function takes several arguments, including blocks, clusters,
treatment probabilities, whether randomization is simple or not, and more.
Passing the outcome of that function, an object of class
<code>"ra_declaration"</code> to the <code>ra_declaration</code> argument in this function,
will lead to a call of the <code><a href="declaration_to_condition_pr_mat.html">declaration_to_condition_pr_mat</a></code>
function which generates the condition probability matrix needed to
estimate treatment effects and standard errors. We provide many examples
below of how this could be done.</p>
<p>The second way is to pass the names of vectors in your <code>data</code> to
<code>condition_prs</code>, <code>blocks</code>, and <code>clusters</code>. You can further
specify whether the randomization was simple or complete using the <code>simple</code>
argument. Note that if <code>blocks</code> are specified the randomization is
always treated as complete. From these vectors, the function learns how to
build the condition probability matrix that is used in estimation.</p>
<p>In the case
where <code>condition_prs</code> is specified, this function assumes those
probabilities are the marginal probability that each unit is in condition2
and then uses the other arguments (<code>blocks</code>, <code>clusters</code>,
<code>simple</code>) to learn the rest of the design. If users do not pass
<code>condition_prs</code>, this function learns the probability of being in
condition2 from the data. That is, none of these arguments are specified,
we assume that there was a simple randomization where the probability
of each unit being in condition2 was the average of all units in condition2.
Similarly, we learn the block-level probability of treatment within
<code>blocks</code> by looking at the mean number of units in condition2 if
<code>condition_prs</code> is not specified.</p>
<p>The third way is to pass a <code>condition_pr_mat</code> directly. One can
see more about this object in the documentation for
<code><a href="declaration_to_condition_pr_mat.html">declaration_to_condition_pr_mat</a></code> and
<code><a href="permutations_to_condition_pr_mat.html">permutations_to_condition_pr_mat</a></code>. Essentially, this 2n * 2n
matrix allows users to specify marginal and joint marginal probabilities
of units being in conditions 1 and 2 of arbitrary complexity. Users should
only use this option if they are certain they know what they are doing.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Aronow, Peter M, and Joel A Middleton. 2013. "A Class of Unbiased Estimators of the Average Treatment Effect in Randomized Experiments." Journal of Causal Inference 1 (1): 135-54. <a href="https://doi.org/10.1515/jci-2012-0009" class="external-link">doi:10.1515/jci-2012-0009</a>
.</p>
<p>Aronow, Peter M, and Cyrus Samii. 2017. "Estimating Average Causal Effects Under Interference Between Units." Annals of Applied Statistics, forthcoming. <a href="https://arxiv.org/abs/1305.6156v3" class="external-link">https://arxiv.org/abs/1305.6156v3</a>.</p>
<p>Middleton, Joel A, and Peter M Aronow. 2015. "Unbiased Estimation of the Average Treatment Effect in Cluster-Randomized Experiments." Statistics, Politics and Policy 6 (1-2): 39-75. <a href="https://doi.org/10.1515/spp-2013-0002" class="external-link">doi:10.1515/spp-2013-0002</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/randomizr/man/declare_ra.html" class="external-link">declare_ra</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set seed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulate data</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/randomizr/" class="external-link">randomizr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span><span class="co"># 1. Simple random assignment</span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">p</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you only pass condition_prs, we assume simple random sampling</span></span></span>
<span class="r-in"><span><span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, condition_prs <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Std. Error    t value Pr(&gt;|t|)  CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z -0.2532128   0.609167 -0.4156706 0.677651 -1.447158 0.9407325 NA</span>
<span class="r-in"><span><span class="co"># Assume constant effects instead</span></span></span>
<span class="r-in"><span><span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, condition_prs <span class="op">=</span> <span class="va">p</span>, se_type <span class="op">=</span> <span class="st">"constant"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Std. Error    t value  Pr(&gt;|t|)  CI Lower CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z -0.2532128  0.6038814 -0.4193088 0.6749904 -1.436799 0.930373 NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Also can use randomizr to pass a declaration</span></span></span>
<span class="r-in"><span><span class="va">srs_declaration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomizr/man/declare_ra.html" class="external-link">declare_ra</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.5</span>, simple <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, ra_declaration <span class="op">=</span> <span class="va">srs_declaration</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Std. Error    t value Pr(&gt;|t|)  CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z -0.2532128   0.609167 -0.4156706 0.677651 -1.447158 0.9407325 NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span><span class="co"># 2. Complete random assignment</span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Can use a declaration</span></span></span>
<span class="r-in"><span><span class="va">crs_declaration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomizr/man/declare_ra.html" class="external-link">declare_ra</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, prob <span class="op">=</span> <span class="fl">0.5</span>, simple <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, ra_declaration <span class="op">=</span> <span class="va">crs_declaration</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Std. Error   t value  Pr(&gt;|t|)  CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z -0.2312303  0.5310475 -0.435423 0.6632554 -1.272064 0.8096037 NA</span>
<span class="r-in"><span><span class="co"># Can precompute condition_pr_mat and pass it</span></span></span>
<span class="r-in"><span><span class="co"># (faster for multiple runs with same condition probability matrix)</span></span></span>
<span class="r-in"><span><span class="va">crs_pr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="declaration_to_condition_pr_mat.html">declaration_to_condition_pr_mat</a></span><span class="op">(</span><span class="va">crs_declaration</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, condition_pr_mat <span class="op">=</span> <span class="va">crs_pr_mat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Estimate Std. Error   t value  Pr(&gt;|t|)  CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z -0.2312303  0.5310475 -0.435423 0.6632554 -1.272064 0.8096037 NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span><span class="co"># 3. Clustered treatment, complete random assigment</span></span></span>
<span class="r-in"><span><span class="co">#-----------</span></span></span>
<span class="r-in"><span><span class="co"># Simulating data</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">clust_crs_decl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomizr/man/declare_ra.html" class="external-link">declare_ra</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, clusters <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">cl</span>, prob <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomizr/man/conduct_ra.html" class="external-link">conduct_ra</a></span><span class="op">(</span><span class="va">clust_crs_decl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Easiest to specify using declaration</span></span></span>
<span class="r-in"><span><span class="va">ht_cl</span> <span class="op">&lt;-</span> <span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, ra_declaration <span class="op">=</span> <span class="va">clust_crs_decl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Also can pass the condition probability and the clusters</span></span></span>
<span class="r-in"><span><span class="va">ht_cl_manual</span> <span class="op">&lt;-</span> <span class="fu">horvitz_thompson</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="va">z</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>  clusters <span class="op">=</span> <span class="va">cl</span>,</span></span>
<span class="r-in"><span>  condition_prs <span class="op">=</span> <span class="va">prob</span>,</span></span>
<span class="r-in"><span>  simple <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ht_cl</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std. Error   t value  Pr(&gt;|t|)   CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z 0.0482231   0.230729 0.2090032 0.8344458 -0.4039975 0.5004437 NA</span>
<span class="r-in"><span><span class="va">ht_cl_manual</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std. Error   t value  Pr(&gt;|t|)   CI Lower  CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z 0.0482231   0.230729 0.2090032 0.8344458 -0.4039975 0.5004437 NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Blocked estimators specified similarly</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span><span class="co"># More complicated assignment</span></span></span>
<span class="r-in"><span><span class="co">#----------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># arbitrary permutation matrix</span></span></span>
<span class="r-in"><span><span class="va">possible_treats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">arb_pr_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="permutations_to_condition_pr_mat.html">permutations_to_condition_pr_mat</a></span><span class="op">(</span><span class="va">possible_treats</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Simulating a column to be realized treatment</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">possible_treats</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">possible_treats</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu">horvitz_thompson</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, condition_pr_mat <span class="op">=</span> <span class="va">arb_pr_mat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Estimate Std. Error   t value  Pr(&gt;|t|)   CI Lower CI Upper DF</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z 0.7576713  0.7715048 0.9820695 0.3260656 -0.7544502 2.269793 NA</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Luke Sonnet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

