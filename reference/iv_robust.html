<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Two-Stage Least Squares Instrumental Variables Regression — iv_robust • estimatr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Two-Stage Least Squares Instrumental Variables Regression — iv_robust"><meta name="description" content="This formula estimates an instrumental variables regression
using two-stage least squares with a variety of options for robust
standard errors"><meta property="og:description" content="This formula estimates an instrumental variables regression
using two-stage least squares with a variety of options for robust
standard errors"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">estimatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/getting-started.html">Getting started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting started using estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/absorbing-fixed-effects.html">Absorbing Fixed Effects with estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/estimatr-in-the-tidyverse.html">estimatr in the Tidyverse</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarking-estimatr.html">Benchmarking estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/emmeans-examples.html">Examples with emmeans</a></li>
    <li><a class="dropdown-item" href="../articles/mathematical-notes.html">Mathematical notes for estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/regression-tables.html">Regression Tables with estimatr</a></li>
    <li><a class="dropdown-item" href="../articles/simulations-debiasing-dim.html">Simulations - Debiasing Difference-in-Means</a></li>
    <li><a class="dropdown-item" href="../articles/simulations-ols-variance.html">Simulations - OLS and Variance</a></li>
    <li><a class="dropdown-item" href="../articles/stata-wls-hat.html">How Stata's hat matrix differs with weights</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-software" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Software</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-software"><li><a class="external-link dropdown-item" href="http://declaredesign.org/r/declaredesign/">DeclareDesign</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/randomizr/">randomizr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/fabricatr/">fabricatr</a></li>
    <li><a class="dropdown-item" href="https://declaredesign.org/r/estimatr/">estimatr</a></li>
    <li><a class="external-link dropdown-item" href="https://declaredesign.org/r/designlibrary/">DesignLibrary</a></li>
    <li><a class="external-link dropdown-item" href="https://eos.wzb.eu/ipi/DDWizard/">DesignWizard</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://declaredesign.org">declaredesign.org</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Two-Stage Least Squares Instrumental Variables Regression</h1>
      <small class="dont-index">Source: <a href="https://github.com/DeclareDesign/estimatr/blob/main/R/estimatr_iv_robust.R" class="external-link"><code>R/estimatr_iv_robust.R</code></a></small>
      <div class="d-none name"><code>iv_robust.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This formula estimates an instrumental variables regression
using two-stage least squares with a variety of options for robust
standard errors</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">iv_robust</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">weights</span>,</span>
<span>  <span class="va">subset</span>,</span>
<span>  <span class="va">clusters</span>,</span>
<span>  <span class="va">fixed_effects</span>,</span>
<span>  se_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ci <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  diagnostics <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_vcov <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  try_cholesky <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>an object of class formula of the regression and the instruments.
For example, the formula <code>y ~ x1 + x2 | z1 + z2</code> specifies <code>x1</code> and <code>x2</code>
as endogenous regressors and <code>z1</code> and <code>z2</code> as their respective instruments.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.frame</code></p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>the bare (unquoted) names of the weights variable in the
supplied data.</p></dd>


<dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>An optional bare (unquoted) expression specifying a subset
of observations to be used.</p></dd>


<dt id="arg-clusters">clusters<a class="anchor" aria-label="anchor" href="#arg-clusters"></a></dt>
<dd><p>An optional bare (unquoted) name of the variable that
corresponds to the clusters in the data.</p></dd>


<dt id="arg-fixed-effects">fixed_effects<a class="anchor" aria-label="anchor" href="#arg-fixed-effects"></a></dt>
<dd><p>An optional right-sided formula containing the fixed
effects that will be projected out of the data, such as <code>~ blockID</code>. Do not
pass multiple-fixed effects with intersecting groups. Speed gains are greatest for
variables with large numbers of groups and when using "HC1" or "stata" standard errors.
See 'Details'.</p></dd>


<dt id="arg-se-type">se_type<a class="anchor" aria-label="anchor" href="#arg-se-type"></a></dt>
<dd><p>The sort of standard error sought. If <code>clusters</code> is
not specified the options are "HC0", "HC1" (or "stata", the equivalent),
 "HC2" (default), "HC3", or
"classical". If <code>clusters</code> is specified the options are "CR0", "CR2" (default), or "stata". Can also specify "none", which may speed up estimation of the coefficients.</p></dd>


<dt id="arg-ci">ci<a class="anchor" aria-label="anchor" href="#arg-ci"></a></dt>
<dd><p>logical. Whether to compute and return p-values and confidence
intervals, TRUE by default.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>The significance level, 0.05 by default.</p></dd>


<dt id="arg-diagnostics">diagnostics<a class="anchor" aria-label="anchor" href="#arg-diagnostics"></a></dt>
<dd><p>logical. Whether to compute and return instrumental variable diagnostic statistics and tests.</p></dd>


<dt id="arg-return-vcov">return_vcov<a class="anchor" aria-label="anchor" href="#arg-return-vcov"></a></dt>
<dd><p>logical. Whether to return the variance-covariance
matrix for later usage, TRUE by default.</p></dd>


<dt id="arg-try-cholesky">try_cholesky<a class="anchor" aria-label="anchor" href="#arg-try-cholesky"></a></dt>
<dd><p>logical. Whether to try using a Cholesky
decomposition to solve least squares instead of a QR decomposition,
FALSE by default. Using a Cholesky decomposition may result in speed gains, but should only
be used if users are sure their model is full-rank (i.e., there is no
perfect multi-collinearity)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>"iv_robust"</code>.</p>
<p>The post-estimation commands functions <code>summary</code> and <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></code>
return results in a <code>data.frame</code>. To get useful data out of the return,
you can use these data frames, you can use the resulting list directly, or
you can use the generic accessor functions <code>coef</code>, <code>vcov</code>,
<code>confint</code>, and <code>predict</code>.</p>
<p>An object of class <code>"iv_robust"</code> is a list containing at least the
following components:</p>
<dl><dt>coefficients</dt>
<dd><p>the estimated coefficients</p></dd>

  <dt>std.error</dt>
<dd><p>the estimated standard errors</p></dd>

  <dt>statistic</dt>
<dd><p>the t-statistic</p></dd>

  <dt>df</dt>
<dd><p>the estimated degrees of freedom</p></dd>

  <dt>p.value</dt>
<dd><p>the p-values from a two-sided t-test using <code>coefficients</code>, <code>std.error</code>, and <code>df</code></p></dd>

  <dt>conf.low</dt>
<dd><p>the lower bound of the <code>1 - alpha</code> percent confidence interval</p></dd>

  <dt>conf.high</dt>
<dd><p>the upper bound of the <code>1 - alpha</code> percent confidence interval</p></dd>

  <dt>term</dt>
<dd><p>a character vector of coefficient names</p></dd>

  <dt>alpha</dt>
<dd><p>the significance level specified by the user</p></dd>

  <dt>se_type</dt>
<dd><p>the standard error type specified by the user</p></dd>

  <dt>res_var</dt>
<dd><p>the residual variance</p></dd>

  <dt>nobs</dt>
<dd><p>the number of observations used</p></dd>

  <dt>k</dt>
<dd><p>the number of columns in the design matrix (includes linearly dependent columns!)</p></dd>

  <dt>rank</dt>
<dd><p>the rank of the fitted model</p></dd>

  <dt>vcov</dt>
<dd><p>the fitted variance covariance matrix</p></dd>

  <dt>r.squared</dt>
<dd><p>the \(R^2\) of the second stage regression</p></dd>

  <dt>adj.r.squared</dt>
<dd><p>the \(R^2\) of the second stage regression, but penalized for having more parameters, <code>rank</code></p></dd>

  <dt>fstatistic</dt>
<dd><p>a vector with the value of the second stage F-statistic with the numerator and denominator degrees of freedom</p></dd>

  <dt>firststage_fstatistic</dt>
<dd><p>a vector with the value of the first stage F-statistic with the numerator and denominator degrees of freedom, useful for a test for weak instruments</p></dd>

  <dt>weighted</dt>
<dd><p>whether or not weights were applied</p></dd>

  <dt>call</dt>
<dd><p>the original function call</p></dd>

  <dt>fitted.values</dt>
<dd><p>the matrix of predicted means</p></dd>

</dl><p>We also return <code>terms</code> with the second stage terms and <code>terms_regressors</code> with the first stage terms, both of which used by <code>predict</code>. If <code>fixed_effects</code> are specified, then we return <code>proj_fstatistic</code>, <code>proj_r.squared</code>, and <code>proj_adj.r.squared</code>, which are model fit statistics that are computed on the projected model (after demeaning the fixed effects).</p>
<p>We also return various diagnostics when <code>`diagnostics` == TRUE</code>. These are stored in <code>diagnostic_first_stage_fstatistic</code>, <code>diagnostic_endogeneity_test</code>, and <code>diagnostic_overid_test</code>. They have the test statistic, relevant degrees of freedom, and p.value in a named vector. See 'Details' for more. These are printed in a formatted table when the model object is passed to <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function performs two-stage least squares estimation to fit
instrumental variables regression. The syntax is similar to that in
<code>ivreg</code> from the <code>AER</code> package. Regressors and instruments
should be specified in a two-part formula, such as
<code>y ~ x1 + x2 | z1 + z2 + z3</code>, where <code>x1</code> and <code>x2</code> are
regressors and <code>z1</code>, <code>z2</code>, and <code>z3</code> are instruments. Unlike
<code>ivreg</code>, you must explicitly specify all exogenous regressors on
both sides of the bar.</p>
<p>The default variance estimators are the same as in <code><a href="lm_robust.html">lm_robust</a></code>.
Without clusters, we default to <code>HC2</code> standard errors, and with clusters
we default to <code>CR2</code> standard errors. 2SLS variance estimates are
computed using the same estimators as in <code><a href="lm_robust.html">lm_robust</a></code>, however the
design matrix used are the second-stage regressors, which includes the estimated
endogenous regressors, and the residuals used are the difference
between the outcome and a fit produced by the second-stage coefficients and the
first-stage (endogenous) regressors. More notes on this can be found at
<a href="https://declaredesign.org/r/estimatr/articles/mathematical-notes.html">the mathematical appendix</a>.</p>
<p>If <code>fixed_effects</code> are specified, both the outcome, regressors, and instruments
are centered using the method of alternating projections (Halperin 1962; Gaure 2013). Specifying
fixed effects in this way will result in large speed gains with standard error
estimators that do not need to invert the matrix of fixed effects. This means using
"classical", "HC0", "HC1", "CR0", or "stata" standard errors will be faster than other
standard error estimators. Be wary when specifying fixed effects that may result
in perfect fits for some observations or if there are intersecting groups across
multiple fixed effect variables (e.g. if you specify both "year" and "country" fixed effects
with an unbalanced panel where one year you only have data for one country).</p>
<p>If <code>diagnostics</code> are requested, we compute and return three sets of diagnostics.
First, we return tests for weak instruments using first-stage F-statistics (<code>diagnostic_first_stage_fstatistic</code>). Specifically,
the F-statistics reported compare the model regressing each endogeneous variable on both the
included exogenous variables and the instruments to a model where each endogenous variable is
regressed only on the included exogenous variables (without the instruments). A significant F-test
for weak instruments provides evidence against the null hypothesis that the instruments are weak.
Second, we return tests for the endogeneity of the endogenous variables, often called the Wu-Hausman
test  (<code>diagnostic_endogeneity_test</code>). We implement the regression test from Hausman (1978), which allows for robust variance estimation.
A significant endogeneity test provides evidence against the null that all the variables are exogenous.
Third, we return a test for the correlation between the instruments and the error term  (<code>diagnostic_overid_test</code>). We implement
the Wooldridge (1995) robust score test, which is identical to Sargan's (1958) test with classical
standard errors. This test is only reported if the model is overidentified (i.e. the number of
instruments is greater than the number of endogenous regressors), and if no weights are specified.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Gaure, Simon. 2013. "OLS with multiple high dimensional category variables." Computational Statistics &amp; Data Analysis 66: 8-1. <a href="https://doi.org/10.1016/j.csda.2013.03.024" class="external-link">doi:10.1016/j.csda.2013.03.024</a></p>
<p>Halperin, I. 1962. "The product of projection operators." Acta Scientiarum Mathematicarum (Szeged) 23(1-2): 96-99.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://declaredesign.org/r/fabricatr/" class="external-link">fabricatr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fabricatr/man/fabricate.html" class="external-link">fabricate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  N <span class="op">=</span> <span class="fl">40</span>,</span></span>
<span class="r-in"><span>  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">N</span>, lambda <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  D  <span class="op">=</span> <span class="va">Z</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  G <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Instrument for treatment `D` with encouragement `Z`</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu">iv_robust</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">+</span> <span class="va">X</span> <span class="op">|</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term   estimate std.error  statistic      p.value   conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept) 3.32899931 0.3532949 9.42272101 2.261759e-11  2.6131558 4.0448428</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           D 0.31231384 0.6515096 0.47936952 6.344971e-01 -1.0077700 1.6323977</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           X 0.03953936 0.4343723 0.09102642 9.279626e-01 -0.8405826 0.9196613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 37       Y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 37       Y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 37       Y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Instrument with Stata's `ivregress 2sls , small rob` HC1 variance</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu">iv_robust</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">|</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">dat</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term  estimate std.error statistic      p.value  conf.low conf.high df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept) 3.3157895 0.3419679 9.6962023 7.990568e-12  2.623512  4.008067 38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           D 0.3184211 0.6522180 0.4882126 6.282047e-01 -1.001925  1.638767 38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       Y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       Y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With clusters, we use CR2 errors by default</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu">iv_robust</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">|</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">dat</span>, clusters <span class="op">=</span> <span class="va">cl</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term  estimate std.error statistic     p.value   conf.low conf.high</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept) 3.3157895 0.4457303 7.4390043 0.002360625  2.0374558  4.594123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           D 0.3184211 0.4682124 0.6800782 0.533811304 -0.9820125  1.618855</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 3.698715       Y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 3.996357       Y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Again, easy to replicate Stata (again with `small` correction in Stata)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu">iv_robust</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">|</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">dat</span>, clusters <span class="op">=</span> <span class="va">cl</span>, se_type <span class="op">=</span> <span class="st">"stata"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          term  estimate std.error statistic     p.value   conf.low conf.high df</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept) 3.3157895 0.4414454 7.5112102 0.001681356  2.0901405  4.541438  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           D 0.3184211 0.4634526 0.6870629 0.529805076 -0.9683296  1.605172  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       Y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       Y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can also specify fixed effects, that will be taken as exogenous regressors</span></span></span>
<span class="r-in"><span><span class="co"># Speed gains with fixed effects are greatests with "stata" or "HC1" std.errors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="fu">iv_robust</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">D</span> <span class="op">|</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">dat</span>, fixed_effects <span class="op">=</span> <span class="op">~</span> <span class="va">G</span>, se_type <span class="op">=</span> <span class="st">"HC1"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   term  estimate std.error statistic   p.value  conf.low conf.high df outcome</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    D 0.2509696 0.6728668 0.3729855 0.7114087 -1.115023  1.616962 35       Y</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Luke Sonnet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

